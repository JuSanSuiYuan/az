# AZè¯­è¨€è‡ªä¸¾å®ç°è®¡åˆ’

## ç›®æ ‡
åœ¨æœ€çŸ­æ—¶é—´å†…å®ç°AZè¯­è¨€çš„è‡ªä¸¾ç¼–è¯‘ï¼Œä½¿å…¶èƒ½å¤Ÿç¼–è¯‘è‡ªå·±çš„ç¼–è¯‘å™¨ä»£ç ã€‚

## å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²å®Œæˆ
1. **Bootstrapç¼–è¯‘å™¨** (Python) - 100%
   - è¯æ³•åˆ†æå™¨
   - è¯­æ³•åˆ†æå™¨
   - è§£é‡Šæ‰§è¡Œå™¨
   - å¯ä»¥è¿è¡Œç®€å•çš„AZç¨‹åº

2. **C++å‰ç«¯** - 90%
   - è¯æ³•åˆ†æå™¨ (100%)
   - è¯­æ³•åˆ†æå™¨ (100%)
   - è¯­ä¹‰åˆ†æå™¨ (90%)
   - Matchè¯­å¥æ”¯æŒ (80%)

3. **MLIRç”Ÿæˆå™¨** - 60%
   - åŸºç¡€æ¡†æ¶ (100%)
   - è¡¨è¾¾å¼ç”Ÿæˆ (60%)
   - è¯­å¥ç”Ÿæˆ (40%)

### âŒ ç¼ºå¤±å…³é”®éƒ¨åˆ†
1. **LLVMåç«¯** - 0%
   - MLIRåˆ°LLVM IRé™çº§
   - ä»£ç ç”Ÿæˆ
   - ç›®æ ‡æ–‡ä»¶ç”Ÿæˆ

2. **é“¾æ¥å™¨é›†æˆ** - 0%
   - è°ƒç”¨ç³»ç»Ÿé“¾æ¥å™¨
   - ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶

3. **æ ‡å‡†åº“** - 0%
   - åŸºç¡€I/Oå‡½æ•°
   - å­—ç¬¦ä¸²æ“ä½œ
   - å†…å­˜ç®¡ç†

## å¿«é€Ÿè‡ªä¸¾ç­–ç•¥

### æ–¹æ¡ˆA: å®Œæ•´å®ç°ï¼ˆæ—¶é—´ï¼š2-3ä¸ªæœˆï¼‰
å®ŒæˆLLVMåç«¯ â†’ å®ç°æ ‡å‡†åº“ â†’ ç¼–è¯‘è‡ªå·±

**ä¼˜ç‚¹**: å®Œæ•´ã€å¥å£®
**ç¼ºç‚¹**: æ—¶é—´å¤ªé•¿

### æ–¹æ¡ˆB: æ··åˆè‡ªä¸¾ï¼ˆæ—¶é—´ï¼š2-4å‘¨ï¼‰â­ æ¨è
ä½¿ç”¨Python Bootstrapç¼–è¯‘å™¨ç¼–è¯‘AZç¼–å†™çš„ç¼–è¯‘å™¨ â†’ ç”ŸæˆC++ä»£ç  â†’ ç¼–è¯‘C++ä»£ç 

**ä¼˜ç‚¹**: å¿«é€ŸéªŒè¯è¯­è¨€è®¾è®¡
**ç¼ºç‚¹**: éœ€è¦å®ç°ä»£ç ç”Ÿæˆåˆ°C++

### æ–¹æ¡ˆC: æœ€å°åŒ–å®ç°ï¼ˆæ—¶é—´ï¼š1-2å‘¨ï¼‰â­â­ æœ€å¿«
åªå®ç°ç¼–è¯‘å™¨æ ¸å¿ƒåŠŸèƒ½ â†’ ä½¿ç”¨Cä½œä¸ºä¸­é—´è¯­è¨€ â†’ å¿«é€Ÿè‡ªä¸¾

**ä¼˜ç‚¹**: æœ€å¿«å®ç°è‡ªä¸¾
**ç¼ºç‚¹**: åŠŸèƒ½å—é™

## æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆC - æœ€å°åŒ–å¿«é€Ÿè‡ªä¸¾

### é˜¶æ®µ1: å‡†å¤‡å·¥ä½œï¼ˆ1-2å¤©ï¼‰

#### 1.1 ç®€åŒ–ç¼–è¯‘å™¨ä»£ç 
- ç§»é™¤ä¸å¿…è¦çš„ç‰¹æ€§
- åªä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼š
  - åŸºæœ¬ç±»å‹ï¼ˆint, string, boolï¼‰
  - å‡½æ•°å®šä¹‰å’Œè°ƒç”¨
  - å˜é‡å£°æ˜
  - if/whileæ§åˆ¶æµ
  - åŸºæœ¬è¿ç®—ç¬¦

#### 1.2 å®ç°Cä»£ç ç”Ÿæˆå™¨
åœ¨Python Bootstrapç¼–è¯‘å™¨ä¸­æ·»åŠ Cä»£ç ç”Ÿæˆï¼š
```python
class CCodeGenerator:
    def generate(self, ast: Program) -> str:
        # ç”ŸæˆCä»£ç 
        pass
```

### é˜¶æ®µ2: æ ¸å¿ƒå®ç°ï¼ˆ3-5å¤©ï¼‰

#### 2.1 å®ç°åŸºç¡€ä»£ç ç”Ÿæˆ
```python
# ç”ŸæˆCå‡½æ•°
fn add(a: int, b: int) int {
    return a + b;
}

# è½¬æ¢ä¸ºCä»£ç 
int add(int a, int b) {
    return a + b;
}
```

#### 2.2 å®ç°ç±»å‹æ˜ å°„
```
AZç±»å‹ â†’ Cç±»å‹
int    â†’ int
string â†’ char*
bool   â†’ int
void   â†’ void
```

#### 2.3 å®ç°å†…ç½®å‡½æ•°
```c
// åœ¨ç”Ÿæˆçš„Cä»£ç ä¸­åŒ…å«
void println(const char* str) {
    printf("%s\n", str);
}
```

### é˜¶æ®µ3: ç¼–è¯‘å™¨è‡ªä¸¾ï¼ˆ5-7å¤©ï¼‰

#### 3.1 ç®€åŒ–ç¼–è¯‘å™¨ä»£ç 
åˆ›å»º `compiler/minimal/` ç›®å½•ï¼ŒåŒ…å«æœ€å°åŒ–çš„ç¼–è¯‘å™¨ï¼š
- `lexer.az` - è¯æ³•åˆ†æå™¨
- `parser.az` - è¯­æ³•åˆ†æå™¨
- `codegen.az` - Cä»£ç ç”Ÿæˆå™¨
- `main.az` - ä¸»ç¨‹åº

#### 3.2 ç¬¬ä¸€æ¬¡è‡ªä¸¾
```bash
# ä½¿ç”¨Python Bootstrapç¼–è¯‘å™¨ç¼–è¯‘AZç¼–è¯‘å™¨
python bootstrap/az_compiler.py compiler/minimal/main.az --emit-c -o az_compiler.c

# ç¼–è¯‘ç”Ÿæˆçš„Cä»£ç 
gcc az_compiler.c -o az_compiler

# æµ‹è¯•æ–°ç¼–è¯‘å™¨
./az_compiler examples/hello.az
```

#### 3.3 ç¬¬äºŒæ¬¡è‡ªä¸¾
```bash
# ä½¿ç”¨ç¬¬ä¸€ä»£AZç¼–è¯‘å™¨ç¼–è¯‘è‡ªå·±
./az_compiler compiler/minimal/main.az --emit-c -o az_compiler2.c

# ç¼–è¯‘
gcc az_compiler2.c -o az_compiler2

# éªŒè¯ä¸¤ä¸ªç¼–è¯‘å™¨ç”Ÿæˆç›¸åŒçš„ä»£ç 
diff az_compiler.c az_compiler2.c
```

### é˜¶æ®µ4: ä¼˜åŒ–å’Œå®Œå–„ï¼ˆå¯é€‰ï¼‰

#### 4.1 æ·»åŠ æ›´å¤šç‰¹æ€§
- ç»“æ„ä½“
- æ•°ç»„
- Matchè¯­å¥
- é”™è¯¯å¤„ç†

#### 4.2 ä¼˜åŒ–ç”Ÿæˆçš„ä»£ç 
- å¸¸é‡æŠ˜å 
- æ­»ä»£ç æ¶ˆé™¤
- ç®€å•çš„å¯„å­˜å™¨åˆ†é…

## è¯¦ç»†å®ç°æ­¥éª¤

### æ­¥éª¤1: åœ¨Bootstrapç¼–è¯‘å™¨ä¸­æ·»åŠ Cä»£ç ç”Ÿæˆ

```python
# åœ¨ bootstrap/az_compiler.py ä¸­æ·»åŠ 

class CCodeGenerator:
    def __init__(self):
        self.output = []
        self.indent_level = 0
    
    def generate(self, program: Program) -> str:
        """ç”ŸæˆCä»£ç """
        self.output = []
        
        # æ·»åŠ å¤´æ–‡ä»¶
        self.emit("#include <stdio.h>")
        self.emit("#include <stdlib.h>")
        self.emit("#include <string.h>")
        self.emit("")
        
        # ç”Ÿæˆå‡½æ•°å£°æ˜
        for stmt in program.statements:
            if stmt.kind == StmtKind.FUNC_DECL:
                self.gen_func_decl(stmt)
        
        return '\n'.join(self.output)
    
    def gen_func_decl(self, stmt: Stmt):
        # è¿”å›ç±»å‹
        return_type = self.map_type(stmt.return_type)
        
        # å‡½æ•°ç­¾å
        params = ', '.join([
            f"{self.map_type(p.type_name)} {p.name}"
            for p in stmt.params
        ])
        
        self.emit(f"{return_type} {stmt.name}({params}) {{")
        self.indent_level += 1
        
        # å‡½æ•°ä½“
        self.gen_stmt(stmt.body)
        
        self.indent_level -= 1
        self.emit("}")
        self.emit("")
    
    def map_type(self, az_type: str) -> str:
        """æ˜ å°„AZç±»å‹åˆ°Cç±»å‹"""
        type_map = {
            'int': 'int',
            'float': 'double',
            'string': 'char*',
            'bool': 'int',
            'void': 'void'
        }
        return type_map.get(az_type, 'void')
    
    def emit(self, code: str):
        """è¾“å‡ºä¸€è¡Œä»£ç """
        indent = '    ' * self.indent_level
        self.output.append(indent + code)
```

### æ­¥éª¤2: åˆ›å»ºæœ€å°åŒ–ç¼–è¯‘å™¨

åˆ›å»º `compiler/minimal/main.az`:

```az
// æœ€å°åŒ–AZç¼–è¯‘å™¨

import std.io;

fn main() int {
    println("AZ Minimal Compiler v0.1");
    
    // è¯»å–æºæ–‡ä»¶
    let source = read_file("input.az");
    
    // è¯æ³•åˆ†æ
    let tokens = tokenize(source);
    
    // è¯­æ³•åˆ†æ
    let ast = parse(tokens);
    
    // ç”ŸæˆCä»£ç 
    let c_code = generate_c(ast);
    
    // å†™å…¥è¾“å‡ºæ–‡ä»¶
    write_file("output.c", c_code);
    
    println("ç¼–è¯‘å®Œæˆï¼");
    return 0;
}
```

### æ­¥éª¤3: æµ‹è¯•å’ŒéªŒè¯

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_bootstrap.sh`:

```bash
#!/bin/bash

echo "=== AZè¯­è¨€è‡ªä¸¾æµ‹è¯• ==="

# ç¬¬ä¸€æ¬¡ç¼–è¯‘
echo "[1/3] ä½¿ç”¨Python Bootstrapç¼–è¯‘AZç¼–è¯‘å™¨..."
python bootstrap/az_compiler.py compiler/minimal/main.az --emit-c -o gen/az1.c
gcc gen/az1.c -o gen/az1

# ç¬¬äºŒæ¬¡ç¼–è¯‘
echo "[2/3] ä½¿ç”¨ç¬¬ä¸€ä»£ç¼–è¯‘å™¨ç¼–è¯‘è‡ªå·±..."
./gen/az1 compiler/minimal/main.az --emit-c -o gen/az2.c
gcc gen/az2.c -o gen/az2

# ç¬¬ä¸‰æ¬¡ç¼–è¯‘
echo "[3/3] ä½¿ç”¨ç¬¬äºŒä»£ç¼–è¯‘å™¨ç¼–è¯‘è‡ªå·±..."
./gen/az2 compiler/minimal/main.az --emit-c -o gen/az3.c
gcc gen/az3.c -o gen/az3

# éªŒè¯
echo "éªŒè¯ç”Ÿæˆçš„ä»£ç ..."
diff gen/az2.c gen/az3.c

if [ $? -eq 0 ]; then
    echo "âœ… è‡ªä¸¾æˆåŠŸï¼ä¸¤æ¬¡ç¼–è¯‘ç”Ÿæˆç›¸åŒçš„ä»£ç ã€‚"
else
    echo "âŒ è‡ªä¸¾å¤±è´¥ï¼ç”Ÿæˆçš„ä»£ç ä¸ä¸€è‡´ã€‚"
fi
```

## æ—¶é—´è¡¨

### ç¬¬1å‘¨
- **Day 1-2**: å®ç°Cä»£ç ç”Ÿæˆå™¨åŸºç¡€æ¡†æ¶
- **Day 3-4**: å®ç°è¡¨è¾¾å¼å’Œè¯­å¥çš„Cä»£ç ç”Ÿæˆ
- **Day 5-7**: æµ‹è¯•å’Œè°ƒè¯•ä»£ç ç”Ÿæˆå™¨

### ç¬¬2å‘¨
- **Day 8-10**: åˆ›å»ºæœ€å°åŒ–ç¼–è¯‘å™¨ä»£ç 
- **Day 11-12**: ç¬¬ä¸€æ¬¡è‡ªä¸¾æµ‹è¯•
- **Day 13-14**: ä¿®å¤é—®é¢˜ï¼Œå®Œæˆè‡ªä¸¾

## æˆåŠŸæ ‡å‡†

1. âœ… Python Bootstrapèƒ½å¤Ÿå°†AZä»£ç ç¼–è¯‘ä¸ºCä»£ç 
2. âœ… ç”Ÿæˆçš„Cä»£ç èƒ½å¤ŸæˆåŠŸç¼–è¯‘
3. âœ… ç¬¬ä¸€ä»£AZç¼–è¯‘å™¨èƒ½å¤Ÿç¼–è¯‘è‡ªå·±
4. âœ… ç¬¬äºŒä»£å’Œç¬¬ä¸‰ä»£ç¼–è¯‘å™¨ç”Ÿæˆç›¸åŒçš„ä»£ç 
5. âœ… ç¼–è¯‘å™¨èƒ½å¤Ÿç¼–è¯‘æ‰€æœ‰ç¤ºä¾‹ç¨‹åº

## é£é™©å’Œåº”å¯¹

### é£é™©1: Cä»£ç ç”Ÿæˆå¤æ‚åº¦é«˜
**åº”å¯¹**: å…ˆå®ç°æœ€ç®€å•çš„åŠŸèƒ½ï¼Œé€æ­¥æ·»åŠ 

### é£é™©2: ç±»å‹ç³»ç»Ÿä¸åŒ¹é…
**åº”å¯¹**: ä½¿ç”¨ç®€å•çš„ç±»å‹æ˜ å°„ï¼Œé¿å…å¤æ‚ç±»å‹

### é£é™©3: å†…å­˜ç®¡ç†é—®é¢˜
**åº”å¯¹**: åˆæœŸä½¿ç”¨ç®€å•çš„malloc/freeï¼ŒåæœŸä¼˜åŒ–

### é£é™©4: æ ‡å‡†åº“ç¼ºå¤±
**åº”å¯¹**: ç›´æ¥ä½¿ç”¨Cæ ‡å‡†åº“å‡½æ•°

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆä»Šå¤©ï¼‰
1. åœ¨Bootstrapç¼–è¯‘å™¨ä¸­æ·»åŠ `--emit-c`é€‰é¡¹
2. å®ç°åŸºç¡€çš„Cä»£ç ç”Ÿæˆå™¨æ¡†æ¶
3. æµ‹è¯•ç®€å•å‡½æ•°çš„Cä»£ç ç”Ÿæˆ

### æœ¬å‘¨å®Œæˆ
1. å®Œæ•´çš„Cä»£ç ç”Ÿæˆå™¨
2. èƒ½å¤Ÿç¼–è¯‘ç®€å•çš„AZç¨‹åºåˆ°C
3. æµ‹è¯•ç”Ÿæˆçš„Cä»£ç 

### ä¸‹å‘¨å®Œæˆ
1. åˆ›å»ºæœ€å°åŒ–ç¼–è¯‘å™¨
2. ç¬¬ä¸€æ¬¡è‡ªä¸¾
3. éªŒè¯å’Œæµ‹è¯•

## æ€»ç»“

é€šè¿‡ä½¿ç”¨Cä½œä¸ºä¸­é—´è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨2å‘¨å†…å®ç°AZè¯­è¨€çš„è‡ªä¸¾ã€‚è¿™ä¸ªæ–¹æ¡ˆï¼š

- âœ… å®ç°å¿«é€Ÿ
- âœ… æŠ€æœ¯é£é™©ä½
- âœ… å¯ä»¥éªŒè¯è¯­è¨€è®¾è®¡
- âœ… ä¸ºåç»­LLVMåç«¯æ‰“ä¸‹åŸºç¡€

**è®©æˆ‘ä»¬å¼€å§‹å§ï¼** ğŸš€
